# 人机交互设计文档

## 设计背景与思路

### 用户画像

番茄商城主要面向以下几类用户：
1. **图书爱好者**
   - 年龄：18-45 岁
   - 特点：热爱阅读，经常购买图书，对图书内容有较高要求
   - 需求：希望能方便地找到各类优质图书，获取详细的图书信息，分享读书心得
2. **学生群体**
   - 年龄：16-25 岁
   - 特点：为学习或考试购买书籍，预算有限，对价格敏感
   - 需求：价格合理，能够查看评价和推荐，方便比较不同版本
3. **知识工作者**
   - 年龄：25-45 岁
   - 特点：为工作需要购买专业书籍，注重实用性
   - 需求：详细准确的书籍信息，专业分类，便捷的支付和配送服务
4. **管理员**
   - 特点：负责商城的日常运营和管理
   - 需求：便捷的商品管理、订单处理和用户管理功能

### 设计理念

番茄商城的设计围绕以下几个核心理念：
1. **简洁直观**：界面设计简洁明了，用户能够快速找到所需功能和信息。
2. **响应式体验**：适配多种设备和屏幕尺寸，确保良好的用户体验。
3. **渐进式功能**：基本功能（浏览、购买）简单易用，高级功能（评论、笔记、推荐）在需要时提供。
4. **视觉一致性**：采用一致的色彩（以番茄红为主色调）、字体和交互方式，提供统一的品牌体验。
5. **高效交互**：减少用户操作步骤，优化关键流程（如购买、支付），提高用户效率。

## 业务流程

番茄商城的核心业务流程如下，包括用户注册登录、商品浏览、购物车管理、下单支付等环节：

```mermaid
flowchart TD
    subgraph 用户
        A[访客] --> B{是否登录}
        B -->|否| C[注册/登录]
        B -->|是| D[登录用户]
    end

    subgraph 商品浏览
        D --> E[浏览商品列表]
        E --> F[查看商品详情]
        F --> G{加入购物车}
        G -->|否| E
        G -->|是| H[购物车]
    end

    subgraph 购物与结算
        H --> I{是否结算}
        I -->|否| E
        I -->|是| J[填写订单信息]
        J --> K[选择支付方式]
        K --> L{是否支付成功}
        L -->|否| M[支付失败]
        L -->|是| N[订单完成]
        M --> K
        N --> O[查看订单]
    end

    subgraph 商品管理
        P[管理员] --> Q[商品管理]
        Q --> R[添加商品]
        Q --> S[编辑商品]
        Q --> T[管理库存]
        Q --> U[删除商品]
    end
```

### 详细业务流程（泳道图）

以下泳道图展示了买家购物的完整业务流程，以及各角色之间的交互：

```mermaid
flowchart TD
    subgraph 用户
        U1[访问商城] --> U2[浏览商品]
        U2 --> U3[查看商品详情]
        U3 --> U4[加入购物车]
        U4 --> U5[查看购物车]
        U5 --> U6[结算]
        U6 --> U7[填写收货信息]
        U7 --> U8[选择支付方式]
        U8 --> U9[支付订单]
        U9 --> U10[查看订单状态]
    end

    subgraph 前端系统
        F1[渲染首页] --> F2[显示商品列表]
        F2 --> F3[显示商品详情]
        F3 --> F4[更新购物车状态]
        F4 --> F5[计算购物车总额]
        F5 --> F6[生成订单表单]
        F6 --> F7[验证订单信息]
        F7 --> F8[调用支付接口]
        F8 --> F9[显示支付结果]
        F9 --> F10[更新订单状态]
    end

    subgraph 后端服务
        S1[提供商品数据] --> S2[查询商品详情]
        S2 --> S3[更新购物车]
        S3 --> S4[创建订单]
        S4 --> S5[预留库存]
        S5 --> S6[处理支付请求]
        S6 --> S7{支付成功？}
        S7 -->|是| S8[确认订单]
        S7 -->|否| S9[恢复库存]
        S8 --> S10[通知订单状态]
        S9 --> S10
    end

    subgraph 数据库
        D1[商品表] --> D2[库存表]
        D2 --> D3[购物车表]
        D3 --> D4[订单表]
        D4 --> D5[支付记录表]
    end

    %% 连接用户与前端
    U1 --> F1
    U2 --> F2
    U3 --> F3
    U4 --> F4
    U5 --> F5
    U6 --> F6
    U7 --> F7
    U8 --> F8
    U9 --> F9
    U10 --> F10

    %% 连接前端与后端
    F1 --> S1
    F2 --> S2
    F3 --> S3
    F6 --> S4
    F7 --> S5
    F8 --> S6
    F9 --> S7
    F10 --> S10

    %% 连接后端与数据库
    S1 --> D1
    S2 --> D1
    S3 --> D3
    S4 --> D4
    S5 --> D2
    S6 --> D5
    S8 --> D4
    S9 --> D2
```

## 页面交互

### 产品结构、信息结构

#### 产品结构图

产品结构图展示了番茄商城的整体功能模块：

```mermaid
mindmap
  root((番茄商城))
    前台
        用户模块
            登录
            注册
            个人信息
            地址管理
        商品模块
            商品列表
            商品详情
            商品搜索
        购物模块
            购物车
        交易模块
            订单结算
            订单支付
            订单列表
            订单详情
        书评模块
            书评列表
            发表书评
            回复书评
        读书笔记模块
            笔记列表
            创建笔记
            笔记详情
            分享笔记
        个性化推荐模块
            相关推荐
    后台
        管理员模块
            管理员登录
        商品管理模块
            商品列表
            添加/编辑商品
            库存管理
            删除商品
        订单管理模块
            订单列表
            订单详情
            处理订单
```

#### 信息结构图

信息结构图展示了各页面包含的主要信息元素：

```mermaid
mindmap
  root((信息结构))
    首页
        商品推荐列表
            商品图片
            商品名称
            商品价格
            评分
        广告轮播图
        分类导航
    商品详情页
        商品基本信息
            商品名称
            价格
            评分
            库存状态
        商品图片
        商品规格
            作者
            出版社
        商品描述
        商品详细内容
        书评信息
            评分统计
            用户评论
    购物车页面
        商品列表
            商品图片
            商品名称
            单价
            数量
            小计
        总计金额
        结算按钮
    结算页面
        收货地址
        支付方式
        订单商品
            商品图片
            商品名称
            数量
            价格
        订单汇总
            商品总金额
            应付总额
    订单支付页面
        订单号
        支付金额
        支付方式选择
        支付表单
    订单详情页面
        订单状态
        订单号
        下单时间
        支付时间
        收货地址
        商品信息
        订单金额
    个人中心页面
        用户信息
            头像
            用户名
            邮箱
            手机号
        我的订单
        收货地址
```

### 操作流程图

#### 用户注册登录

```mermaid
flowchart TD
    A[访客] --> B{是否有账号}
    B -->|是| C[登录页面]
    B -->|否| D[注册页面]

    D --> D1[填写用户信息]
    D1 --> D2{信息验证}
    D2 -->|验证失败| D1
    D2 -->|验证成功| D3[注册成功]
    D3 --> C

    C --> C1[输入账号密码]
    C1 --> C2{验证账号}
    C2 -->|验证失败| C1
    C2 -->|验证成功| C3[登录成功]
    C3 --> E[首页]

    style A fill:#f9f7f7,stroke:#577590
    style C3 fill:#e0fbfc,stroke:#3d5a80
    style D3 fill:#e0fbfc,stroke:#3d5a80
    style E fill:#98c1d9,stroke:#3d5a80
```

#### 商品浏览与购买

```mermaid
%%{init: {'theme':'neutral'}}%%
flowchart TD
    A[首页/商品列表] --> B[商品详情]
    B --> C{是否购买}
    C -->|是| D[加入购物车]
    C -->|否| A
    D --> E[查看购物车]
    E --> F{是否结算}
    F -->|是| G[订单结算页]
    F -->|否| A
    G --> H[填写收货信息]
    H --> I[选择支付方式]
    I --> J[提交订单]
    J --> K[订单支付]
    K --> L{支付成功？}
    L -->|是| M[支付成功页]
    L -->|否| N[支付失败页]
    M --> O[查看订单详情]
    N --> P{重新支付?}
    P -->|是| K
    P -->|否| Q[订单列表]

    style A fill:#f9f7f7,stroke:#577590
    style D fill:#e0fbfc,stroke:#3d5a80
    style J fill:#98c1d9,stroke:#3d5a80
    style M fill:#ffb703,stroke:#023047
```

#### 后台商品管理

```mermaid
%%{init: {'theme':'neutral'}}%%
flowchart TD
    A[管理员登录] --> B[后台管理页面]
    B --> C[商品管理]
    C --> D{操作选择}
    D -->|添加商品| E[填写商品信息]
    D -->|编辑商品| F[修改商品信息]
    D -->|管理库存| G[调整库存数量]
    D -->|删除商品| H{确认删除？}
    E --> I[提交商品信息]
    F --> I
    G --> J[提交库存变更]
    H -->|是| K[执行删除]
    H -->|否| C
    I --> C
    J --> C
    K --> C

    style A fill:#f9f7f7,stroke:#577590
    style B fill:#e0fbfc,stroke:#3d5a80
    style C fill:#98c1d9,stroke:#3d5a80
    style H fill:#ffb703,stroke:#023047
```

### 原型图

比较简陋的原型图（也没实现「优惠券」啊，也不在自选计划中啊）：

![](./images/coupon-proto.png)

## 全局通用说明

### 常用控件

番茄商城采用 Element Plus 组件库，并结合自定义样式，主要使用以下控件：

1. **按钮 `el-button`**
   - 主按钮：番茄红色调，圆角边框，用于主要操作
   - 次要按钮：白色背景，边框样式，用于次要操作
   - 危险按钮：红色调，用于删除等危险操作

   示例样式：
   ```css
   .el-button--primary {
     @apply bg-tomato-500 border-tomato-500 hover:bg-tomato-600 hover:border-tomato-600 transition-all duration-300;
     box-shadow: 0 4px 15px 0 rgba(255, 107, 107, 0.4);
     border-radius: 0.75rem;
   }
   ```

2. **输入框 `el-input`**
   - 标准输入框：带有轻微阴影和聚焦效果
   - 搜索框：带有搜索图标
   - 文本域：多行文本输入

   示例样式：
   ```css
   .el-input__wrapper {
     transition: all 0.3s ease;
     border-radius: 0.75rem;
     box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
     background-color: rgba(255, 255, 255, 0.8);
     backdrop-filter: blur(8px);
   }
   ```

3. **表单项 `el-form-item`**
   - 标签位置：顶部对齐
   - 错误提示：文本下方红色提示

4. **选择器 `el-select`**
   - 下拉菜单式选择器
   - 带搜索功能的选择器

5. **表格 `el-table`**
   - 带边框的标准表格
   - 可选择、可排序
   - 支持自定义列模板

6. **分页器 `el-pagination`**
   - 带页码和页面大小选择

7. **对话框 `el-dialog`**
   - 模态对话框，用于确认操作或表单提交
   - 带有半透明背景遮罩

   示例样式：
   ```css
   .el-dialog {
     @apply rounded-2xl overflow-hidden;
     backdrop-filter: blur(15px);
     background-color: rgba(255, 255, 255, 0.95);
   }
   ```

8. **消息提示 `el-message`**
   - 成功、警告、错误、信息四种类型
   - 顶部居中显示，自动消失

9. **加载状态 `el-loading`**
   - 全屏加载
   - 局部组件加载

10. **标签 `el-tag`**
    - 不同颜色标签用于状态区分
    - 可关闭标签

### 复用界面/组件

以下是番茄商城中全局可复用的组件：

1. **页面布局组件**
   - `Header.vue`: 页面顶部导航栏，包含 Logo、搜索框、导航菜单和用户区域
   - `Footer.vue`: 页面底部，包含网站信息、联系方式和友情链接
   - `PageTransition.vue`: 页面切换过渡效果组件

2. **商品相关组件**
   - `ProductCard.vue`: 商品卡片，用于商品列表展示
   - `ProductForm.vue`: 商品表单，用于添加/编辑商品
   - `ProductRating.vue`: 商品评分展示组件

3. **用户相关组件**
   - `LoginForm.vue`: 登录表单
   - `RegisterForm.vue`: 注册表单
   - `ProfileForm.vue`: 个人信息表单

4. **交互反馈组件**
   - `ConfettiButton.vue`: 点击后显示庆祝效果的按钮
   - `EmptyState.vue`: 数据为空状态展示
   - `ErrorState.vue`: 错误状态展示

5. **广告组件**
   - `AdvertisementCard.vue`: 广告卡片
   - `AdvertisementList.vue`: 广告列表

### 单位规范

为确保界面一致性，番茄商城遵循以下单位规范：

1. **时间格式**
   - 刚刚：当前时间 - 创建时间 < 1 分钟
   - x 分钟前：当前时间 - 创建时间 < 1 小时
   - x 小时前：当前时间 - 创建时间 < 24 小时
   - 昨天 HH:MM：当前时间 - 创建时间 < 48 小时
   - MM 月 DD 日：当前年份的其他日期
   - YYYY 年 MM 月 DD 日：非当前年份的日期
   - 详细时间格式：YYYY-MM-DD HH:MM:SS

2. **金额格式**
   - 使用 ¥ 符号前缀
   - 数字格式：¥1,234.56
   - 整数金额：¥1,234
   - 免费商品：¥0 或「免费」

   实现代码（`formatPrice` 函数）：
   ```typescript
   export function formatPrice(price?: number): string {
     if (price === undefined || price === null) return "¥0.00";
     return new Intl.NumberFormat("zh-CN", {
       style: "currency",
       currency: "CNY",
       minimumFractionDigits: price % 1 === 0 ? 0 : 2,
     }).format(price);
   }
   ```

3. **尺寸单位**
   - 字体大小：使用 rem/em 单位，如 1rem, 1.25rem
   - 间距与外边距：使用 rem 或 Tailwind CSS 的间距类，如 p-4, my-6
   - 边框圆角：使用 rem 或 Tailwind CSS 的圆角类，如 rounded-lg
   - 图片尺寸：根据场景使用百分比、rem 或固定像素值

4. **数量格式**
   - 数量显示：直接展示数字，如 5, 10
   - 大数量显示：使用千分位分隔符，如 1,234
   - 库存状态：
     - 充足：> 10
     - 紧张：≤ 10
     - 无货：0

### 缺省页汇总

番茄商城针对不同状态提供了以下缺省页面：

1. **加载中**
   - 使用 `el-skeleton` 组件显示骨架屏
   - 带有淡入淡出动画效果
   ```vue
   <div v-if="loading" class="max-w-6xl mx-auto">
     <el-skeleton :rows="10" animated />
   </div>
   ```

2. **空数据状态**
   - 使用 `el-empty` 组件
   - 根据上下文提供个性化描述文本
   - 提供后续操作按钮
   ```vue
   <el-empty
     description="您的购物车是空的"
     class="py-16"
   >
     <template #extra>
       <el-button type="primary" @click="router.push(Routes.PRODUCT_LIST)" class="rounded-lg">
         去购物
       </el-button>
     </template>
   </el-empty>
   ```

3. **错误状态**
   - 使用 `el-result` 组件
   - 显示错误图标、标题和描述
   - 提供重试或返回按钮
   ```vue
   <el-result
     icon="error"
     title="商品不存在"
     sub-title="找不到该商品或已被删除"
   >
     <template #extra>
       <el-button type="primary" @click="router.push(Routes.PRODUCT_LIST)" class="rounded-lg">
         查看所有商品
       </el-button>
     </template>
   </el-result>
   ```

4. **订单状态变更**
   - 支付成功：显示成功图标、庆祝动画和订单信息
   - 支付失败：显示错误图标和重试选项
   - 订单取消：显示信息图标和取消原因

各模块具体缺省页如下：

- **商品模块**
  - 商品不存在：显示错误提示和「查看所有商品」按钮
- **购物车模块**
  - 购物车为空：显示「购物车是空的」提示和「去购物」按钮
- **订单模块**
  - 订单不存在：显示「订单不存在或已被删除」提示
- **用户模块**
  - 未登录状态：显示登录提示和登录按钮
