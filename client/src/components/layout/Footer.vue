<template>
  <footer class="bg-gradient-to-b from-gray-50 to-gray-100 pt-12 pb-8">
    <div class="container mx-auto px-4">
      <!-- é¡¶éƒ¨åŒºåŸŸï¼šå¿«é€Ÿé“¾æ¥å’Œè®¢é˜… -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10 footer-sections">
        <!-- å…¬å¸ç®€ä»‹ -->
        <div class="md:col-span-1 footer-section">
          <div class="flex items-center mb-4">
            <div class="text-3xl mr-2">ğŸ…</div>
            <div class="text-xl font-bold text-tomato-600">ç•ªèŒ„ä¹¦åŸ</div>
          </div>
          <p class="text-gray-600 mb-4">
            æ‚¨çš„çº¿ä¸Šé˜…è¯»ä¼™ä¼´ï¼Œæä¾›æµ·é‡ç²¾é€‰å›¾ä¹¦ï¼Œè®©é˜…è¯»æˆä¸ºæ—¥å¸¸ç”Ÿæ´»ä¸­çš„ç¾å¥½ä¹ æƒ¯ã€‚
          </p>
          <div class="flex space-x-3">
            <a href="#" class="text-gray-500 hover:text-tomato-500 transition-colors social-icon">
              <el-icon size="20">
                <ChatDotRound />
              </el-icon>
            </a>
            <a href="#" class="text-gray-500 hover:text-tomato-500 transition-colors social-icon">
              <el-icon size="20">
                <Promotion />
              </el-icon>
            </a>
            <a href="#" class="text-gray-500 hover:text-tomato-500 transition-colors social-icon">
              <el-icon size="20">
                <Share />
              </el-icon>
            </a>
          </div>
        </div>

        <!-- é“¾æ¥åŒºåŸŸ -->
        <div class="md:col-span-2 grid grid-cols-2 sm:grid-cols-3 gap-6 footer-section">
          <!-- äº§å“ä¸æœåŠ¡ -->
          <div>
            <h4 class="text-sm font-semibold uppercase tracking-wider text-gray-800 mb-4 footer-heading">äº§å“ä¸æœåŠ¡</h4>
            <ul class="space-y-2 footer-links">
              <li v-for="(link, index) in productLinks" :key="index">
                <a href="#" class="text-gray-600 hover:text-tomato-500 transition-colors text-sm footer-link">{{ link }}</a>
              </li>
            </ul>
          </div>

          <!-- å…³äºæˆ‘ä»¬ -->
          <div>
            <h4 class="text-sm font-semibold uppercase tracking-wider text-gray-800 mb-4 footer-heading">å…³äºæˆ‘ä»¬</h4>
            <ul class="space-y-2 footer-links">
              <li v-for="(link, index) in aboutLinks" :key="index">
                <a href="#" class="text-gray-600 hover:text-tomato-500 transition-colors text-sm footer-link">{{ link }}</a>
              </li>
            </ul>
          </div>

          <!-- æ”¯æŒ -->
          <div>
            <h4 class="text-sm font-semibold uppercase tracking-wider text-gray-800 mb-4 footer-heading">å®¢æˆ·æ”¯æŒ</h4>
            <ul class="space-y-2 footer-links">
              <li v-for="(link, index) in supportLinks" :key="index">
                <a href="#" class="text-gray-600 hover:text-tomato-500 transition-colors text-sm footer-link">{{ link }}</a>
              </li>
            </ul>
          </div>
        </div>

        <!-- è®¢é˜…åŒºåŸŸ -->
        <div class="md:col-span-1 footer-section">
          <h4 class="text-sm font-semibold uppercase tracking-wider text-gray-800 mb-4 footer-heading">è®¢é˜…æ›´æ–°</h4>
          <p class="text-gray-600 text-sm mb-4">è®¢é˜…æˆ‘ä»¬çš„æ–°ä¹¦æ¨èå’Œç‰¹æƒ ä¿¡æ¯</p>
          <div class="flex">
            <el-input v-model="email" placeholder="æ‚¨çš„é‚®ç®±åœ°å€" class="modern-input rounded-r-none" :prefix-icon="Message" />
            <el-button type="primary" class="rounded-l-none" :loading="subscribing" @click="handleSubscribe">
              è®¢é˜…
            </el-button>
          </div>
          <p class="text-xs text-gray-500 mt-2">
            æˆ‘ä»¬å°Šé‡æ‚¨çš„éšç§ï¼Œç»ä¸ä¼šå‘ç¬¬ä¸‰æ–¹åˆ†äº«æ‚¨çš„ä¿¡æ¯ã€‚
          </p>
        </div>
      </div>

      <!-- åˆ†éš”çº¿ -->
      <div class="border-t border-gray-200 pt-8 flex flex-col sm:flex-row justify-between items-center footer-bottom">
        <p class="text-gray-600 text-sm mb-4 sm:mb-0">
          Â© {{ currentYear }} ç•ªèŒ„ä¹¦åŸ. ä¿ç•™æ‰€æœ‰æƒåˆ©
        </p>
        <div class="flex space-x-6">
          <a href="#" class="text-gray-500 hover:text-tomato-500 transition text-sm">éšç§æ”¿ç­–</a>
          <a href="#" class="text-gray-500 hover:text-tomato-500 transition text-sm">æœåŠ¡æ¡æ¬¾</a>
          <a href="#" class="text-gray-500 hover:text-tomato-500 transition text-sm">Cookie æ”¿ç­–</a>
        </div>
      </div>
    </div>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <div
      v-show="showBackToTop"
      ref="backToTopBtn"
      class="fixed bottom-8 right-8 bg-white p-3 rounded-full shadow-lg cursor-pointer hover:bg-tomato-50 transition-colors w-12 h-12 flex items-center justify-center"
      @click="scrollToTop">
      <el-icon size="20" class="text-tomato-500">
        <Top />
      </el-icon>
    </div>
  </footer>
</template>

<script setup lang="ts">
import {
  ChatDotRound,
  Message,
  Promotion,
  Share,
  Top,
} from "@element-plus/icons-vue";
import { ElMessage } from "element-plus";
import { gsap } from "gsap";
import { onMounted, onUnmounted, ref } from "vue";

const currentYear = new Date().getFullYear();
const showBackToTop = ref(false);
const email = ref("");
const subscribing = ref(false);
const backToTopBtn = ref(null);

// é“¾æ¥æ•°æ®
const productLinks = ["å›¾ä¹¦åˆ†ç±»", "ç‰¹æƒ æ´»åŠ¨", "æ–°ä¹¦ä¸Šæ¶", "ç•…é”€æ¦œå•", "ç”µå­ä¹¦"];
const aboutLinks = ["å…¬å¸ç®€ä»‹", "åŠ å…¥æˆ‘ä»¬", "æ–°é—»èµ„è®¯", "è”ç³»æˆ‘ä»¬", "åˆä½œä¼™ä¼´"];
const supportLinks = [
  "å¸®åŠ©ä¸­å¿ƒ",
  "é…é€æ–¹å¼",
  "é€€æ¢æ”¿ç­–",
  "ä¼šå‘˜ç¦åˆ©",
  "å¸¸è§é—®é¢˜",
];

// ç›‘å¬æ»šåŠ¨äº‹ä»¶
const handleScroll = () => {
  const wasVisible = showBackToTop.value;
  showBackToTop.value = window.scrollY > 300;

  // å½“æŒ‰é’®è¦æ˜¾ç¤ºä¸”ä¹‹å‰æœªæ˜¾ç¤ºæ—¶æ·»åŠ åŠ¨ç”»
  if (showBackToTop.value && !wasVisible && backToTopBtn.value) {
    gsap.fromTo(
      backToTopBtn.value,
      { scale: 0.5, opacity: 0 },
      { scale: 1, opacity: 1, duration: 0.4, ease: "back.out(1.7)" },
    );
  }
};

// å›åˆ°é¡¶éƒ¨
const scrollToTop = () => {
  // ä½¿ç”¨åŸç”Ÿæ»šåŠ¨APIï¼Œé¿å…GSAP ScrollToPluginçš„ä¾èµ–é—®é¢˜
  window.scrollTo({
    top: 0,
    behavior: "smooth",
  });
};

// å¤„ç†è®¢é˜…
const handleSubscribe = () => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if (!email.value.trim()) {
    ElMessage.warning("è¯·è¾“å…¥é‚®ç®±åœ°å€");
    return;
  }

  if (!emailRegex.test(email.value)) {
    ElMessage.error("è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€");

    // æ·»åŠ è¾“å…¥æ¡†æŠ–åŠ¨æ•ˆæœ
    const inputEl = document.querySelector(".modern-input .el-input__wrapper");
    if (inputEl) {
      gsap.fromTo(
        inputEl,
        { x: 0 },
        { x: [-5, 5, -3, 3, 0], duration: 0.4, ease: "power2.out" },
      );
    }
    return;
  }

  subscribing.value = true;

  // æ¨¡æ‹Ÿè®¢é˜…è¯·æ±‚
  setTimeout(() => {
    ElMessage.success({
      message: "è®¢é˜…æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„å…³æ³¨",
      icon: "el-icon-success",
    });
    email.value = "";
    subscribing.value = false;

    // æˆåŠŸåŠ¨ç”»æ•ˆæœ
    const btnEl = document.querySelector(".modern-input + .el-button");
    if (btnEl) {
      gsap.fromTo(
        btnEl,
        { scale: 1 },
        {
          scale: 1.1,
          duration: 0.2,
          ease: "back.out(2)",
          repeat: 1,
          yoyo: true,
        },
      );
    }
  }, 1000);
};

onMounted(() => {
  window.addEventListener("scroll", handleScroll);

  // æ·»åŠ é¡µè„šå…ƒç´ çš„å…¥åœºåŠ¨ç”»
  gsap.fromTo(
    ".footer-section",
    { y: 30, opacity: 0 },
    {
      y: 0,
      opacity: 1,
      stagger: 0.1,
      duration: 0.6,
      ease: "power2.out",
    },
  );

  // æ·»åŠ é“¾æ¥çš„å…¥åœºåŠ¨ç”»
  gsap.fromTo(
    ".footer-link",
    { x: -10, opacity: 0 },
    {
      x: 0,
      opacity: 1,
      stagger: 0.03,
      delay: 0.3,
      duration: 0.4,
      ease: "power1.out",
    },
  );

  // æ·»åŠ é¡µè„šåº•éƒ¨çš„å…¥åœºåŠ¨ç”»
  gsap.fromTo(
    ".footer-bottom",
    { y: 20, opacity: 0 },
    {
      y: 0,
      opacity: 1,
      delay: 0.5,
      duration: 0.5,
      ease: "power2.out",
    },
  );

  // æ·»åŠ ç¤¾äº¤å›¾æ ‡çš„å…¥åœºåŠ¨ç”»
  gsap.fromTo(
    ".social-icon",
    { scale: 0, opacity: 0 },
    {
      scale: 1,
      opacity: 1,
      stagger: 0.1,
      delay: 0.4,
      duration: 0.4,
      ease: "back.out(1.7)",
    },
  );
});

onUnmounted(() => {
  window.removeEventListener("scroll", handleScroll);
});
</script>

<style scoped>
.modern-input :deep(.el-input__wrapper) {
  border-radius: 0.75rem 0 0 0.75rem;
  transition: all 0.3s ease;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  background-color: rgba(255, 255, 255, 0.8);
}

.modern-input :deep(.el-input__wrapper:hover) {
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
  background-color: rgba(255, 255, 255, 0.95);
}

.modern-input :deep(.el-input__wrapper.is-focus) {
  box-shadow: 0 0 0 1px rgba(255, 107, 107, 0.3), 0 3px 10px rgba(0, 0, 0, 0.08);
  background-color: rgba(255, 255, 255, 1);
}

.footer-heading {
  position: relative;
  padding-bottom: 0.5rem;
}

.footer-heading::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: 0;
  height: 2px;
  width: 2rem;
  background-color: var(--el-color-primary);
  border-radius: 1px;
}
</style>
